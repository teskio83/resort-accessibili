@app.route("/")
def index():
    with get_conn() as conn:
        with conn.cursor(cursor_factory=RealDictCursor) as cur:
            cur.execute("""
                SELECT * FROM resorts
                ORDER BY updated_at DESC NULLS LAST, created_at DESC NULLS LAST
            """)
            rows = cur.fetchall()

    resorts = []
    for r in rows:
        obj = as_obj(r)
        have, total = calc_access_score(obj)
        resorts.append((obj, have, total))

    return render_template(
        "index.html",
        resorts=resorts,
        regions=REGIONS,
        status_choices=STATUS_CHOICES,
        filters={}
    )
